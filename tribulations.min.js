/*! tribulations 2013-07-15 */
var Tribulations,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Tribulations=function(a,b,c){var d,e,f;return d={},d.ExperimentRunnerView=function(a){function d(){return e=d.__super__.constructor.apply(this,arguments)}return __extends(d,a),d.prototype.initialize=function(){var a,b,c,d,e;for(e=["experimentStructure","subviewClasses","regionElement","template"],c=0,d=e.length;d>c;c++)a=e[c],this.options[a]||console.error("Test runner was initialized without options."+a+".");return this.template=this.options.template,this.addRegion("experimentRegion",this.options.regionElement),this.currentState=function(){var a,c,d,e;for(d=this.options.subviewClasses,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(0);return e}.call(this),this.currentDepth=0,this.maxDepth=this.options.subviewClasses.length-1,this.experimentStructure=this.options.experimentStructure,this.currentView=null,this.experimentFinished=!1,this.on("runner:sectionBegin",this.sectionBegin),this.on("runner:sectionEnd",this.sectionEnd)},d.prototype.onRender=function(){return this.trigger("runner:sectionBegin")},d.prototype.sectionBegin=function(){var a,d,e,f,g,h;return this.experimentFinished?(console.error("Received a sectionBegin event after experiment finished"),void 0):(h=b.take(this.currentState,this.currentDepth+1),d=this.experimentStructure.getChildAtCoord(h),a=this.options.subviewClasses[this.currentDepth],g=d.get("innerModel"),e=g instanceof c.Model?g:new c.Model(g),f=new a({model:e,state:this.currentState}),this.listenTo(f,"runner:sectionEnd",function(){return this.trigger("runner:sectionEnd")}),this.experimentRegion.show(f))},d.prototype.sectionEnd=function(){if(this.experimentFinished)return console.error("Received a sectionEnd event after experiment finished"),void 0;if(this.currentDepth!==this.maxDepth)this.currentDepth++;else for(;this.currentDepth>=0;){if(!this._isLastChild(this.experimentStructure,this.currentState,this.currentDepth)){this.currentState[this.currentDepth]++;break}this.currentState[this.currentDepth]=0,this.currentDepth--}return-1===this.currentDepth?(this.experimentFinished=!0,this.trigger("runner:experimentEnd")):this.trigger("runner:sectionBegin")},d.prototype._isLastChild=function(a,c,d){var e,f;return e=b.take(c,d+1-1),f=a.getChildrenAtCoord(e).length,c[d]===f-1},d}(c.Marionette.Layout),d.NodeModel=function(a){function b(){return f=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.defaults=function(){return{children:new Array,innerModel:null}},b.prototype.numChildren=function(){return this.get("children").length},b.prototype.getChild=function(a){return this.get("children")[a]},b.prototype.getChildAtCoord=function(a){var b,c,d,e;for(b=this,d=0,e=a.length;e>d;d++)c=a[d],b=b.getChild(c);return b},b.prototype.getChildrenAtCoord=function(a){var b,c,d,e;for(b=this,d=0,e=a.length;e>d;d++)c=a[d],b=b.getChild(c);return b.get("children")},b}(c.Model),d}(jQuery,_,Backbone,Marionette);